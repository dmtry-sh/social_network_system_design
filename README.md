# System Design социальной сети для курса по [System Design](https://balun.courses/courses/system_design)

## Функциональные требования

#### Профили пользователей
- создание профиля в нашей соц. сети, заполнение логина (должен быть уникальный), пароля для входа и краткое описание профиля;
- изменение логина, пароля и краткого описания профиля;
- поиск профилей других пользователей по логину;
- подписка на профили других пользователей;
- просмотр списка подписок на профили и их отмена.

#### Посты
- публикация поста от своего профиля с фотографиями (фото может быть несколько), описанием и привязкой к месту;
- просмотр ленты постов своего профиля в обратном хронологическом порядке;
- просмотр ленты постов других профилей в обратном хронологическом порядке;
- просмотр общей (своей и профилей, на которые подписан) ленты постов в обратном хронологическом порядке.

#### Комментарии
- возможность оставить комментарий под своим или чужим постом;
- возможность просмотра комментариев под своим или чужим постом в хронологическом порядке.

#### Реакции
- возможность поставить реакцию (одну из фиксированного набора эмодзи) на чужой пост;
- просмотр кол-ва реакций на своих или чужих постах, поставленных другими пользователями.

#### Топ популярных мест
- просмотр списка из топ-10 популярных мест, основанного на кол-ве постов по месту, в порядке убывания;
- поиск мест;
- просмотр ленты постов по выбранному месту в обратном хронологическом порядке.

## Нефункциональные требования

#### Аудитория
- Количество пользователей (DAU) линейно вырастет до 10 000 000 за первый год (далее продолжит расти, предположительно, до 20 000 000 за 2й год и до 30 000 000 DAU за 3й);
- Один пользователь, предположительно, публикует в среднем 6 постов в месяц и просматривает посты других пользователей 100 раз за час при этом оставляя реакции в среднем 3 раза в час и оставляя в среднем 2 комментария за час под постами;
- Регионы использования приложения: только СНГ.

#### Особенности
- Сезонность в приложении присутствуют в моменты продаж рекламы у крупных тревел блогеров, промоакций. Так же в летнее время в целом, предположительно, ожидается более высокая активность пользователей, чем в зимнее;
- Данные храним всегда
- Лимиты
    - Ограниченное кол-во подписок на профили других пользователей, предположительно 1 000 000
    - 5 вариантов реакций на посты
    - Получение ленты <= 1 сек
    - Публикация поста < 3 сек
    - Подгрузка фотографий на посте за < 2 сек
- Система должна быть очень надежной (предположительно SLA = 99.99%);
- Система должна быть удобной для взаимодействия с мобильных устройств и браузера.

## Нагрузка

#### Посты
- Пользователь публикует 6 постов в неделю:  
  RPS: 10 000 000 DAU * 6 / 86 400 / 30 ~= 100 (write)
- Пользователь смотрит 100 постов за час:  
  RPS: 10 000 000 DAU * 100 / 86 400 ~= 11 574 (read)
- #### Реакции
- Пользователь просматривает кол-во реакций на каждом посте 100 раз за час:  
  RPS: 10 000 000 DAU * 100 / 86 400 ~= 11 574 (read)
- Пользователь оставляет 3 реакции за час:  
  RPS: 10 000 000 DAU * 3 / 86 400 ~= 347 (write)

#### Комментарии
- Пользователь смотрит комментарии на каждом посте 3 раза за час:  
  RPS: 10 000 000 DAU * 3 * 20 (кол-во комментарий под постом) / 86 400 ~= 6 944 (read)
- Пользователь оставляет 3 комментария за час:  
  RPS: 10 000 000 DAU * 2 / 86 400 ~= 231 (write)

#### Топ популярных мест
- Пользователь в среднем ищет популярные места и смотрит топ 3 раза в месяц:  
  RPS: 10 000 000 DAU * 3 / 86400 / 30 ~= 12

## Трафик

Пост (~200Б):
- id (~8Б)
- description (~100Б)
- lat (~8Б)
- lng (~8Б)
- place_name (~50Б)
- created_at (~8Б)

Фотография (~4МБ):
- id (~8Б)
- post_id (~8Б)
- файл (в S3?) (~4МБ)

Реакция (~24Б):
- type (enum ~8Б)
- post_id (~8Б)
- user_id (~8Б)

Комментарий (~230Б):
- post_id (~8Б)
- author_user_id (~8Б)
- comment (~200Б)
- created_at (~8Б)

Популярное место (~80Б):
- lat (~8Б)
- lng (~8Б)
- place_name (~50Б)
- posts_count (~8Б)

#### Посты
- write: 100 RPS * (4MБ * 2 фото + 200Б) = 100 RPS * 8.02МБ ~= 802 МБ/сек
- read: 11 574 RPS * 8.02МБ ~= 92 823 MБ/сек ~= 92 ГБ/сек

#### Реакции
- read: 11 574 RPS (постов) * 5 (вариантов реакций) * (~8Б кол-во реакций одного типа) ~= 462 960Б ~= 462 КБ/сек ~= 0.5МБ/сек
- write: 347 RPS * 24Б ~= 8 328Б ~= 8КБ/сек

#### Комментарии
- read: 6 944 RPS * 20 (кол-во комментариев за 1 подгрузку) * 230Б = 31 942 400Б/сек ~= 32МБ/сек
- Пользователь оставляет 3 комментария за час:  
  RPS: 231 RPS * 230Б ~= 53КБ/сек

#### Топ популярных мест
- read: 12 RPS * 10 (отдается в выборке) * 80Б ~= 10КБ/сек

## Одновременные соединения

10 000 000 DAU * 0.1 = 1 000 000