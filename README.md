# System Design социальной сети для курса по [System Design](https://balun.courses/courses/system_design)

## Функциональные требования

#### Профили пользователей
- создание профиля в нашей соц. сети, заполнение логина (должен быть уникальный), пароля для входа и краткое описание профиля;
- изменение логина, пароля и краткого описания профиля;
- поиск профилей других пользователей по логину;
- подписка на профили других пользователей;
- просмотр списка подписок на профили и их отмена.

#### Посты
- публикация поста от своего профиля с фотографиями (фото может быть несколько), описанием и привязкой к месту;
- просмотр ленты постов своего профиля в обратном хронологическом порядке;
- просмотр ленты постов других профилей в обратном хронологическом порядке;
- просмотр общей (своей и профилей, на которые подписан) ленты постов в обратном хронологическом порядке.

#### Комментарии
- возможность оставить комментарий под своим или чужим постом;
- возможность просмотра комментариев под своим или чужим постом в хронологическом порядке.

#### Реакции
- возможность поставить реакцию (одну из фиксированного набора эмодзи) на чужой пост;
- просмотр кол-ва реакций на своих или чужих постах, поставленных другими пользователями.

#### Топ популярных мест
- просмотр списка из топ-10 популярных мест, основанного на кол-ве постов по месту, в порядке убывания;
- поиск мест;
- просмотр ленты постов по выбранному месту в обратном хронологическом порядке.

## Нефункциональные требования

#### Аудитория
- Количество пользователей (DAU) линейно вырастет до 10 000 000 за первый год (далее продолжит расти, предположительно, до 20 000 000 за 2й год и до 30 000 000 DAU за 3й);
- Регионы использования приложения: только СНГ;
- Пользователь:
  - публикует в среднем 6 постов в месяц;
  - просматривает в среднем 150 постов в день;
  - оставляет в среднем 72 реакции в день;
  - просматривает в среднем 60 комментариев в день;
  - оставляет в среднем 7 комментариев в день под постами.

#### Особенности
- Сезонность в приложении присутствуют в моменты продаж рекламы у крупных тревел блогеров, промоакций. Так же в летнее время, предположительно, ожидается активность в 2.5 раз более высокая, чем в зимнее;
- Данные храним всегда
- Лимиты
    - Ограниченное кол-во подписок на профили других пользователей, предположительно 1 000 000;
    - 5 вариантов реакций на посты;
    - Получение ленты <= 1.5 сек;
    - Публикация поста <= 1.5 сек;
    - Подгрузка фотографий на посте за <= 2 сек;
    - Размер загружаемых фото не более 15Mb;
    - Кол-во фото в посте не более 5;
- Система должна быть очень надежной (предположительно availability = 99.99%);
- Система должна быть удобной для взаимодействия с мобильных устройств и браузера.

## Нагрузка

#### Посты
- Пользователь публикует 6 постов в месяц:
  RPS: 10 000 000 DAU * 6 / 86 400 / 30 ~= 23 (write)
- Пользователь просматривает 150 постов в день:
  RPS: 10 000 000 DAU * 150 / 86 400 ~= 17 361 (read)

#### Реакции
- Пользователь оставляет 72 реакции в день:  
  RPS: 10 000 000 DAU * 72 / 86 400 ~= 8 333 (write)
- Пользователь просматривает кол-во реакций на каждом посте 150 раз в день:  
  RPS: 10 000 000 DAU * 150 / 86 400 ~= 17 361 (read)

#### Комментарии
- Пользователь оставляет 3 комментария за час:  
  RPS: 10 000 000 DAU * 7 / 86 400 ~= 811 (write)
- Пользователь просматривает 60 комментариев за день:  
  RPS: 10 000 000 DAU * 60 / 86 400 ~= 6 944 (read)

#### Топ популярных мест
- Пользователь в среднем ищет популярные места и смотрит топ 3 раза в месяц:  
  RPS: 10 000 000 DAU * 3 / 86400 / 30 ~= 12

## Трафик

Пост (~200Б):
- id (~8Б)
- description (~100Б)
- lat (~8Б)
- lng (~8Б)
- place_name (~50Б)
- created_at (~8Б)

Фотография (~4МБ):
- id (~8Б)
- post_id (~8Б)
- файл (в S3?) (~4МБ)

Реакция (~24Б):
- type (enum ~8Б)
- post_id (~8Б)
- user_id (~8Б)

Комментарий (~230Б):
- post_id (~8Б)
- author_user_id (~8Б)
- comment (~200Б)
- created_at (~8Б)

Популярное место (~80Б):
- lat (~8Б)
- lng (~8Б)
- place_name (~50Б)
- posts_count (~8Б)

#### Посты
- write: 23 RPS * 200Б ~= 4 600 Б/сек ~= 4.5 КБ/сек
- read: 17 361 RPS * 200Б ~= 3 472 КБ/сек ~= 3.4 МБ/сек 

#### Медиа и фото
- write: 23 RPS * 5 (в среднем фото в посте) * 4МБ = 460 МБ/сек
- read: 17 361 RPS * 5 (в среднем фото в посте) * 4МБ * 0.4 (вес после сжатия при сохранении фото) = 138 888 МБ/сек = 138 ГБ/сек

#### Реакции
- write: 8 333 RPS * 24Б ~= 195 КБ/сек
- read: 17 361 RPS (постов) * 5 (вариантов реакций) * (~8Б кол-во реакций одного типа) ~= 462 КБ/сек ~= 0.5МБ/сек

#### Комментарии
- write: 811 RPS * 230Б ~= 182 КБ/сек
- read: 6 944 RPS * 20 (кол-во комментариев за 1 подгрузку) * 230Б = 31 942 400Б/сек ~= 32МБ/сек

#### Топ популярных мест
- read: 12 RPS * 10 (отдается в выборке) * 80Б ~= 10КБ/сек

## Одновременные соединения

10 000 000 DAU * 0.1 = 1 000 000